# 更新日志

## [v2.1.2] - 2025-01-09

### 问题修复
- **🐛 修复GUI索引越界错误**：解决了加载3D-FREQ2.xlsx时出现的"IndexError: index 539 is out of bounds for axis 0 with size 360"错误
- **GUI数据处理逻辑优化**：修复了`update_2d_plot()`函数中对矩阵格式和传统格式数据的不同处理逻辑
- **数据长度匹配修复**：确保角度数组和增益数组长度始终匹配，避免索引越界

### 技术细节
- 在GUI中区分矩阵格式和传统格式的数据处理方式
- 矩阵格式：直接使用完整的360°数据，无需额外拼接
- 传统格式：正确处理已拼接的数据，创建对应的角度数组
- 增加了数据长度和索引安全性检查

## [v2.1.1] - 2025-01-09

### 问题修复
- **🐛 修复Theta切面数据不连续问题**：解决了3D-FREQ2.xlsx文件在phi=0时theta变化的绘图不连续问题
- **数据处理逻辑优化**：针对矩阵格式数据，改进了`get_gain_data_theta_cut()`函数的处理逻辑
- **连续性验证**：确保数据最大跳跃从异常值降低到正常的0.1dB变化范围

### 技术细节
- 区分矩阵格式和传统格式的theta切面数据处理方式
- 矩阵格式直接返回指定phi角度下的完整360°theta数据
- 传统格式保持原有的数据拼接逻辑
- 增加了详细的调试信息和数据连续性检查

## [v2.1.0] - 2025-01-09

### 新增功能
- **多Excel格式支持**：新增对矩阵格式Excel文件的支持（如3D-FREQ2.xlsx）
- **自动格式检测**：程序可自动识别传统格式和矩阵格式的Excel文件
- **完整球面数据**：支持360°×180°的完整球面天线方向图数据处理
- **增强数据解析**：改进的数据读取算法，支持更大规模的数据矩阵

### 改进功能
- **数据处理优化**：重构了AntennaDataReader类，提高了数据处理效率
- **角度转换**：自动处理弧度到角度的转换，兼容不同单位的输入数据
- **错误处理**：增强了文件读取的错误处理和调试信息输出
- **兼容性保持**：完全向后兼容原有的传统格式文件

### 技术改进
- 新增`_detect_file_format()`方法用于自动格式检测
- 新增`_process_matrix_format()`方法处理矩阵格式数据
- 重构`_process_legacy_format()`方法处理传统格式数据
- 改进Excel文件读取逻辑，支持多工作表文件

### 测试验证
- 添加了完整的测试脚本验证功能
- 验证了两种格式文件的读取和绘图功能
- 确保了数据处理的准确性和稳定性

### 支持的文件格式
- **传统格式**：3D-FREQ.xlsx（Legacy Format）
- **矩阵格式**：3D-FREQ2.xlsx（Matrix Format）
- **CSV格式**：支持多种编码的CSV文件

---

## [v2.0.0] - 之前版本

### 基础功能
- 天线方向图2D/3D可视化
- Excel数据文件读取
- 多频率点支持
- 图像导出功能
- 交互式操作界面